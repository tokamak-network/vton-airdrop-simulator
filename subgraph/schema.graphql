type Protocol @entity(immutable: false) {
  id: ID!
  totalAccounts: BigInt!
  totalTransactions: BigInt!
  totalStaked: BigInt!
}

type Account @entity(immutable: false) {
  id: ID! # address
  transactionCount: BigInt!
  firstSeen: BigInt!
  lastSeen: BigInt!
  totalStaked: BigInt!
  stakingEventCount: BigInt!
  stakingEvents: [StakingEvent!]! @derivedFrom(field: "account")
}

type Staker @entity(immutable: false) {
  id: ID!                              # depositor address
  totalDeposited: BigInt!              # cumulative deposits
  totalWithdrawn: BigInt!              # cumulative withdrawals
  depositCount: Int!
  withdrawalCount: Int!
  firstStakedAt: BigInt!
  lastStakedAt: BigInt!
  deposits: [StakingEvent!]! @derivedFrom(field: "staker")
}

type StakingEvent @entity(immutable: true) {
  id: ID!
  account: Account!
  staker: Staker!
  type: String! # "stake", "unstake", or "withdrawal"
  amount: BigInt!
  layer2: Bytes! # layer2 address
  timestamp: BigInt!
  blockNumber: BigInt!
  txHash: Bytes!
}
